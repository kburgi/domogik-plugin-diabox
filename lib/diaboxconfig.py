#!/usr/bin/python
# -*-coding:Utf-8 -*

# here are variable used in diabox website

minou={}
minou["dev_type"]="diabox.minou"  #domogik json id
minou["name"]="minou"
minou["id"]="11"
minou["temperature"]="minou_d_temperature"
minou["pressure"]="minou_d_pressure"
minou["wind_speed_kts"]="minou_d_wind_rt"
minou["wind_direction"]="minou_d_wind_rt"     #it's the same var
minou["humidity"]="minou_d_humidity"
minou["rain_rate"]="minou_d_rain"

wrach={}
wrach["dev_type"]="diabox.wrach"  #domogik json id
wrach["name"]="wrach"
wrach["id"]="17"
wrach["temperature"]="wrach_temperature"
wrach["pressure"]="wrach_pressure"
wrach["wind_speed_kts"]="wrach_wind_rt"
wrach["wind_direction"]="wrach_wind_rt"     #it's the same var
wrach["humidity"]="wrach_humidity"
wrach["rain_rate"]="wrach_rainRate"

kermorvan={}
kermorvan["dev_type"]="diabox.kermorvan"  #domogik json id
kermorvan["name"]="kermorvan"
kermorvan["id"]="15"
kermorvan["temperature"]="kermorvan_temperature"
kermorvan["pressure"]="kermorvan_pressure"
kermorvan["wind_speed_kts"]="kermorvan_wind_rt"
kermorvan["wind_direction"]="kermorvan_wind_rt"     #it's the same var
kermorvan["humidity"]="kermorvan_humidity"
kermorvan["rain_rate"]="kermorvan_rainRate"

st_mathieu={}
st_mathieu["dev_type"]="diabox.st-mathieu"  #domogik json id
st_mathieu["name"]="st-mathieu"
st_mathieu["id"]="16"
st_mathieu["temperature"]="st-mathieu_temperature"
st_mathieu["pressure"]="st-mathieu_pressure"
st_mathieu["wind_speed_kts"]="st-mathieu_wind_rt"
st_mathieu["wind_direction"]="st-mathieu_wind_rt"     #it's the same var
st_mathieu["humidity"]="st-mathieu_humidity"
st_mathieu["rain_rate"]="st-mathieu_rainrate"

lampaul_plouarzel={}
lampaul_plouarzel["dev_type"]="diabox.lampaul-plouarzel"  #domogik json id
lampaul_plouarzel["name"]="lampaul-plouarzel"
lampaul_plouarzel["id"]="111"
lampaul_plouarzel["temperature"]="temperature"
lampaul_plouarzel["pressure"]="pressure"
lampaul_plouarzel["wind_speed_kts"]="wind_rt"
lampaul_plouarzel["wind_direction"]="wind_rt"     #it's the same var
lampaul_plouarzel["humidity"]="humidity"
lampaul_plouarzel["rain_rate"]="rain-rate"

camping_abers={}
camping_abers["dev_type"]="diabox.camping-abers"  #domogik json id
camping_abers["name"]="camping-abers"
camping_abers["id"]="101"
camping_abers["temperature"]="temperature"
camping_abers["pressure"]="pressure"
camping_abers["wind_speed_kts"]="wind_rt"
camping_abers["wind_direction"]="wind_rt"     #it's the same var
camping_abers["humidity"]="humidity"
camping_abers["rain_rate"]="rainRate"

CN_plougerneau={}
CN_plougerneau["dev_type"]="diabox.cn-plougerneau"  #domogik json id
CN_plougerneau["name"]="cn-plougerneau"
CN_plougerneau["id"]="109"
CN_plougerneau["temperature"]="temperature"
CN_plougerneau["pressure"]="pressure"
CN_plougerneau["wind_speed_kts"]="wind_rt"
CN_plougerneau["wind_direction"]="wind_rt"     #it's the same var
CN_plougerneau["humidity"]="humidity"
CN_plougerneau["rain_rate"]="rain-rate"

CN_guisseny={}
CN_guisseny["dev_type"]="diabox.cn-guisseny"  #domogik json id
CN_guisseny["name"]="cn-guisseny"
CN_guisseny["id"]="104"
CN_guisseny["temperature"]="guisseny_temp"
CN_guisseny["pressure"]="guisseny_press"
CN_guisseny["wind_speed_kts"]="guisseny_wind_rt"
CN_guisseny["wind_direction"]="guisseny_wind_rt"     #it's the same var
CN_guisseny["humidity"]=""
CN_guisseny["rain_rate"]=""

st_cast={}
st_cast["dev_type"]="diabox.st-cast"  #domogik json id
st_cast["name"]="st-cast"
st_cast["id"]="108"
st_cast["temperature"]="temperature"
st_cast["pressure"]="pressure"
st_cast["wind_speed_kts"]="wind_rt"
st_cast["wind_direction"]="wind_rt"     #it's the same var
st_cast["humidity"]="humidity"
st_cast["rain_rate"]="rain-rate"

ifremer_cersat={}
ifremer_cersat["dev_type"]="diabox.ifremer-cersat"  #domogik json id
ifremer_cersat["name"]="ifremer-cersat"
ifremer_cersat["id"]="13"
ifremer_cersat["temperature"]="CERSAT_temp"
ifremer_cersat["pressure"]="CERSAT_press"
ifremer_cersat["wind_speed_kts"]="CERSAT_wind_rt"
ifremer_cersat["wind_direction"]="CERSAT_wind_rt"     #it's the same var
ifremer_cersat["humidity"]=""
ifremer_cersat["rain_rate"]=""

st_anne={}
st_anne["dev_type"]="diabox.st-anne"  #domogik json id
st_anne["name"]="st-anne"
st_anne["id"]="14"
st_anne["temperature"]="stanne_temperature"
st_anne["pressure"]="stanne_pressure"
st_anne["wind_speed_kts"]="stanne_wind_rt"
st_anne["wind_direction"]="stanne_wind_rt"     #it's the same var
st_anne["humidity"]=""
st_anne["rain_rate"]=""

crozon_morgat={}
crozon_morgat["dev_type"]="diabox.crozon-morgat"  #domogik json id
crozon_morgat["name"]="crozon-morgat"
crozon_morgat["id"]="104"
crozon_morgat["temperature"]="temperature"
crozon_morgat["pressure"]="pressure"
crozon_morgat["wind_speed_kts"]="wind_rt"
crozon_morgat["wind_direction"]="wind_rt"     #it's the same var
crozon_morgat["humidity"]="humidity"
crozon_morgat["rain_rate"]="rain-rate"

quimper={}
quimper["dev_type"]="diabox.quimper"  #domogik json id
quimper["name"]="quimper"
quimper["id"]="9997"
quimper["temperature"]="quimper_temperature"
quimper["pressure"]="quimper_pressure"
quimper["wind_speed_kts"]="quimper_wind_rt"
quimper["wind_direction"]="quimper_wind_rt"     #it's the same var
quimper["humidity"]="humidity"
quimper["rain_rate"]=""

port_la_foret={}
port_la_foret["dev_type"]="diabox.port-la-foret" #domogik json id
port_la_foret["name"]="port-la-foret"
port_la_foret["id"]="100"
port_la_foret["temperature"]="plf_temperature"
port_la_foret["pressure"]="plf_pressure"
port_la_foret["wind_speed_kts"]="plf_wind_rt"
port_la_foret["wind_direction"]="plf_wind_rt"     #it's the same var
port_la_foret["humidity"]="plf_humidity"
port_la_foret["rain_rate"]="plf_rainRate"

glenan={}
glenan["dev_type"]="diabox.glenan"  #domogik json id
glenan["name"]="glenan"
glenan["id"]="106"
glenan["temperature"]="glenans_temperature"
glenan["pressure"]="glenans_pressure"
glenan["wind_speed_kts"]="glenans_wind_rt"
glenan["wind_direction"]="glenans_wind_rt"     #it's the same var
glenan["humidity"]="glenans_humidity"
glenan["rain_rate"]="glenan_rainRate"

marseille_pacific_palissades={}
marseille_pacific_palissades["dev_type"]="diabox.marseille-pacific-palissades"  #domogik json id
marseille_pacific_palissades["name"]="marseille-pacific-palissades"
marseille_pacific_palissades["id"]="105"
marseille_pacific_palissades["temperature"]="pacific_temperature"
marseille_pacific_palissades["pressure"]="pacific_pressure"
marseille_pacific_palissades["wind_speed_kts"]="pacific_wind_rt"
marseille_pacific_palissades["wind_direction"]="pacific_wind_rt"     #it's the same var
marseille_pacific_palissades["humidity"]="pacific_humidity"
marseille_pacific_palissades["rain_rate"]="pacific_rainRate"


list_diabox = [ minou, wrach, kermorvan, st_mathieu, lampaul_plouarzel, 
                camping_abers, CN_plougerneau, CN_guisseny, st_cast,
                ifremer_cersat, st_anne, crozon_morgat, quimper, port_la_foret,
                glenan, marseille_pacific_palissades ]

        

class DiaboxConfig():
    """ List of all diabox config """

    def __init__(self, dev_type, domo_log):
        self.domo_log = domo_log
        
        #get the config of the diabox station
        cfg = self.get_dbx_config(dev_type)
        if cfg == None:
            self.isValid=False
        else:
            self.station_name = cfg["name"]
            self.station_id = cfg["id"]   # This is remote id, on diabox website !
            
            self.sensors_url={}

            if cfg["temperature"] != "":
                self.sensors_url["temperature"] = self.get_remote_url(cfg["id"], cfg["temperature"])

            if cfg["pressure"] != "":
                self.sensors_url["pressure"] = self.get_remote_url(cfg["id"], cfg["pressure"])
               
            if cfg["wind_speed_kts"] != "":
                self.sensors_url["wind_speed_kts"] = self.get_remote_url(cfg["id"], cfg["wind_speed_kts"])
                
            if cfg["wind_direction"] != "":
                self.sensors_url["wind_direction"] = self.get_remote_url(cfg["id"], cfg["wind_direction"])

            if cfg["humidity"] != "":
                self.sensors_url["humidity"] = self.get_remote_url(cfg["id"], cfg["humidity"])

            if cfg["rain_rate"] != "":
                self.sensors_url["rain_rate"] = self.get_remote_url(cfg["id"], cfg["rain_rate"])

            self.isValid=True

    def get_dbx_config(self, dev_type):
        """ Iteration over list_diabox to get config for dev_type (diabox.minou / diabox.wrach / ...) """
        for dbx in list_diabox:
            if dev_type == dbx["dev_type"]:
                self.domo_log.info("Diabox config found ! It's the station \"{}\" ! :-)".format(dbx["name"]))
                #print "debug : diabox config found for dbx_name = {}".format(dbx["name"])
                return dbx
        self.domo_log.error("No Diabox config correspondance for diabox_type=\"{}\" !!!!".format(dev_type))
        return None

    def get_remote_url(self, dbx_remote_id, dbx_remote_sensor_var):
        url = "http://avelet.diabox.com/dataUpdate.php?dbx_id={}&dataName={}" \
               .format(dbx_remote_id, dbx_remote_sensor_var)
        #self.domo_log.debug("[DEBUG URL] get_url for diabox {} is :\n".format(self.station_name))
        #self.domo_log.debug("[DEBUG URL] : {}".format(url))
        return url


